{% assign current_variant = product.selected_or_first_available_variant %}
{% assign featured_image = current_variant.featured_image | default: product.featured_image %}

<!-- Gallery & Product Form -->
<div data-section-id="{{ section.id }}" data-section-type="product" data-enable-history-state="true" itemscope>
  <div class="max-width mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-5 gap-10 mt-4">
      <div class="lg:col-span-3">
        <div class="flex mb-4">
          {% include 'breadcrumbs' %}
        </div>
        <div></div>
          <div class="main-carousel carousel mb-5" data-flickity='{ "cellAlign": "left", "contain": true, "prevNextButtons": false, "pageDots": true }'>
              {% for media in product.media %}
                <div class="carousel-cell aspect-w-1 aspect-h-1 w-full" >
                  <img class="object-cover lazy" src="{{ media | img_url: '1000x1000'}}" alt="{{ media.alt }}">
                </div>
              {% endfor %}
          </div>
          <div class="nav-carousel carousel" data-flickity='{ "cellAlign": "left", "contain": true, "prevNextButtons": false, "pageDots": false, "asNavFor": ".main-carousel" }'>
              {% for media in product.media %}
                <div class="carousel-cell">
                    <img class="object-cover" src="{{ media | img_url: '500x500'}}" alt="{{ media.alt }}">
                </div>
              {% endfor %}
          </div>

      </div>
      <div class="lg:col-span-2">
        {% include 'product-form' %}
        {% include 'product-tabs' %}
      </div>
    </div>
  </div>
</div>

{% include 'sticky-add-to-cart' %}


{% schema %}
{
  "name": "Product tabs",
  "max_blocks": 4,
  "blocks": [
    {
      "name": "Product tab",
      "type": "product_tab",
      "settings": [
        {
          "type": "text",
          "id": "product_tab_heading",
          "label": "Heading",
          "default": "Free Shipping"
        },
        {
          "type": "textarea",
          "id": "product_tab_text",
          "label": "Text",
          "default": "Lorem ipsum dolor asimet..."
        }
      ]
    }
  ]
}
{% endschema %}

<script>


    // Function to get the value of the checked radio button in the form.
    function getRadioVal(form, name) {
        var val;
        var radios = form.elements[name];
        for (var i=0, len=radios.length; i<len; i++) {
            if ( radios[i].checked ) {
                val = radios[i].value; 
                break;
            }
        }
        return val;
    }

    {% unless product.has_only_default_variant %}
      $(function(){
        if (!$("input:radio[name='color']").is(":checked") && !$("input:radio[name='size']").is(":checked"){% if product.options[2] %} && !$("input:radio[name='material']").is(":checked"){% endif %}) {
          $("input[name='add']").prop( "disabled", true );
        }
        else {
          $("input[name='add']").prop( "disabled", false );
        }

        $('input').on('click', function(){
          if (!$("input:radio[name='color']").is(":checked") || !$("input:radio[name='size']").is(":checked") {% if product.options[2] %} || !$("input:radio[name='material']").is(":checked"){% endif %}) {
          $("input[name='add']").prop( "disabled", true );
        }
        else {
          $("input[name='add']").prop( "disabled", false );
        }

        });
        
      });
    {% endunless %}
    

    // Function runs every time a variant radio button or select dropdown changes.
    function updateProductInformation() {
      // Save the option select values
      {% if product.options[0] %}
        {% if product.options[0] == 'Color' %}
          var opt1 = getRadioVal( document.getElementById('product_form'), 'color' );
        {% else %}
          var opt1 = document.getElementById('select_one').value;
        {% endif %}
      {% endif %}

      {% if product.options[1] %}
        {% if product.options[1] == 'Size' %}
          var opt2 = getRadioVal( document.getElementById('product_form'), 'size' );
        {% else %}
          var opt2 = document.getElementById('select_two').value;
        {% endif %}
      {% endif %}

      {% if product.options[2] %}
        {% if product.options[2] == 'Material' %}
          var opt3 = getRadioVal( document.getElementById('product_form'), 'material' );
        {% else %}
          var opt3 = document.getElementById('select_three').value;
        {% endif %}
      {% endif %}
      // Capture the quantity and save it as a liquid variable
      var quantity = document.getElementById('quantity').value;
      {% capture quantity %}quantity{% endcapture %}
      var id = '';
      var available;
      // Loop through all of the variants to check if the option values match any of the variant combinations
      {% for v in product.variants %}
        if(opt1=="{{ v.option1 }}"{% if product.options[1] %} && opt2=="{{ v.option2 }}"{% endif %}{% if product.options[2] %} && opt3=="{{ v.option3 }}"{% endif %}) {
          // Save the ID for the specific variant combination.
          var id = {{ v.id }};
          var available = {{ v.available }};
          // Save the price given the quantity the user has selected. Once multiplied then format the price using the js api.
          var fullPrice = {{ quantity }} * {{ v.price }};
          var price = Shopify.formatMoney({{v.price}}, "{{ shop.money_format }}");
          var formattedPrice = Shopify.formatMoney(fullPrice, "{{ shop.money_format }}" );
        }
      {% endfor %}
      // URL Query String
      console.log(window.location.search);
      // If variant has an id then set the cart to the selected variant and change the price field.
      if(id!='') {
        document.getElementById('add_to_cart').setAttribute('data-cart-add', id);
        // document.getElementById('product_price').innerHTML = formattedPrice;
        document.getElementById('price').innerHTML = price;
        $(function(){
          $("input[name='add']").prop( "disabled", false );
        });
        if(available == false){
          document.getElementById('add_to_cart').setAttribute('value', 'Sold Out');
          $(function(){
            $("input[name='add']").prop( "disabled", true );
          });
        } else if (available == true) {
          document.getElementById('add_to_cart').setAttribute('value', 'Add To Cart');
          $(function(){
            $("input[name='add']").prop( "disabled", false );
          });
        }
        
      } else {
        document.getElementById('add_to_cart').setAttribute('data-variant-id', id);
        document.getElementById('add_to_cart').setAttribute('value', 'Add To Cart');
        // document.getElementById('product_price').innerHTML = 'Unavailable';
        document.getElementById('price').innerHTML = 'Unavailable';
        $(function(){
          $("input[name='add']").prop( "disabled", true );
        });
      }
    }
</script>

